<!DOCTYPE html>
<meta charset="utf-8">

<style>

</style>

<body>

<html>
	<script src="https://d3js.org/d3.v6.min.js"></script>
	<script src="https://d3js.org/topojson.v2.min.js"></script>

	<script>	
		var width = 900,
		    height = 750
		
		var cobertura = new Map();
		
		var svg = d3.select("body").append("svg")
			.attr("width", width)
			.attr("height", height);
			
		var projection = d3.geoMercator()
			.center([-50,-8])
			.scale(1000);
			
		var path = d3.geoPath()
			.projection(projection);
			
		var color = d3.scaleLinear()
			.domain([0, 1])
			.range(["#ccc", "rgb(19, 137, 134)"])
			
		var promises = [
		d3.json("https://raw.githubusercontent.com/bralvarenga/bralvarenga.github.io/master/BRMUE250GC_SIRtopo.json"),
		d3.tsv("https://raw.githubusercontent.com/bralvarenga/bralvarenga.github.io/master/lop.tsv", function(d) {
			cobertura.set(d.id, [d.municipio, +d.populacao_2020, +d.valor0119, +d.valor0719, +d.valor0120])
		})
		]
		
		console.log(cobertura)
		
		Promise.all(promises).then(ready)
		
		function ready([geojson]){ 
			
			function mouseover(d){
				div.html(cobertura.get(d.properties.CD_GEOCMU)[0])
				.style("left", (d3.event.pageX + 9) + "px")
				.style("top", (d3.event.pageY - 43) + "px")
				.style("opacity", 0)	
				};
			
			function mouseout(d){
				div
				.style("opacity", 0)	
				};
			
			svg.append("g")
	        .selectAll("path")
	        .data(topojson.feature(geojson, geojson.objects.BRMUE250GC_SIR).features)
	      	.enter().append("path")
			.attr("fill", function(d) { return cobertura.get(d.properties.CD_GEOCMU) ? color(cobertura.get(d.properties.CD_GEOCMU)[2]): "white";})
	        .attr("d", path)
			.style("stroke", "#fff")
			.style("stroke-width", ".5px");
			
			console.log(geojson)
			
	};
				
	</script>	
</body>